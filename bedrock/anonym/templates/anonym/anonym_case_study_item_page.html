{#
 This Source Code Form is subject to the terms of the Mozilla Public
 License, v. 2.0. If a copy of the MPL was not distributed with this
 file, You can obtain one at https://mozilla.org/MPL/2.0/.
#}

{% extends "base-protocol-mozilla.html" %}

{% if page.seo_title %}
  {% set meta_title = page.seo_title %}
{% else %}
  {% set meta_title = page.title %}
{% endif %}

{% block page_title %}{{ meta_title }}{% endblock %}
{% block page_desc %}{{ page.search_description }}{% endblock %}
{% block body_class %}{{ super() }} anonym{% endblock %}

{% block page_css %}
  {{ css_bundle('mozilla-ads') }}
  {{ css_bundle('mozilla-anonym') }}
{% endblock %}

{% block site_header %}
  {% with anonym_index_page=page.get_parent().get_parent() %}
    {% include 'anonym/includes/navigation.html' %}
  {% endwith %}
{% endblock %}

{% block content %}
  <main id="mzan-main" class="anonym-article-page">
    <section class="mzan-section">
      <hgroup class="mzan-hgroup">
        {% if page.company_name %}<p class="mzan-superheading">{{ page.company_name }}</p>{% endif %}
        <h1 class="mzan-heading">{{ page.title }}</h1>
      </hgroup>
    </section>

    {% if page.image %}
  <figure class="mzan-hero-figure is-article add-full-width-borders is-full-width">
  {{ srcset_image(
      page.image,
      "width-{200,400,600,800,1000,1200,1400}",
      sizes="
        (min-width: 768px) 50vw,
        (min-width: 1440px) 680px,
        100vw
      ",
      width=page.image.width,
      loading="lazy",
  ) }}
</figure>
  {% endif %}

  {% if page.link %}
    <aside class="anonym-link-warning-cms-only">
      <p>Note: When the external link field is populated, this page will never be visible.
         The cards used to preview this data will show title, logo, etc. and will
         open a new tab with <strong>{{ page.link }}</strong>.
        </p>
    </aside>
  {% else %}

  {% set ns = namespace(headings=0) %}
    {% for block in page.content %}
      {% if block.block.is_section_block %}
        {% set block_level = 1 if ns.headings == 0 else 2 %}
        {% set ns.headings = ns.headings + 1 %}
      {% endif %}
      {% include_block block %}
    {% endfor %}

    {% if page.notification %}
      {% with value=page.notification %}
        {% with outer_container_class='mzan-notification' %}
          {% with container_class='mzan-notification-container'  %}
            {% include 'mozorg/cms/snippets/notification_snippet.html' %}
          {% endwith %}
        {% endwith %}
      {% endwith %}
    {% endif %}

    {# If there's a link, we don't show the case study content,
       as it's being used as a redirect page. #}
    {% endif %}
  </main>
{% endblock %}
